<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jakarta Itinerary - Collaborative</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .sync-status {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 10px;
            display: inline-block;
            font-size: 0.9em;
        }

        .sync-status.connected {
            background: #4caf50;
        }

        .sync-status.disconnected {
            background: #ef5350;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px 30px;
            background: #fef5f7;
            border-bottom: 2px solid #fce4ec;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(245, 87, 108, 0.15);
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #ad1457;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 1.8em;
            font-weight: bold;
            color: #f5576c;
        }

        .search-section {
            padding: 30px;
            background: #fff3e0;
            border-bottom: 2px solid #ffe0b2;
        }

        .search-section h2 {
            color: #e65100;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid #ffb74d;
            border-radius: 25px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #ff6f00;
            box-shadow: 0 0 0 3px rgba(255, 111, 0, 0.1);
        }

        .search-btn, .add-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .search-btn {
            background: linear-gradient(135deg, #ff6f00 0%, #ff9800 100%);
            color: white;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 111, 0, 0.4);
        }

        .add-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .current-location {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px 15px;
            background: white;
            border-radius: 10px;
            font-size: 0.9em;
            color: #e65100;
        }

        .search-results {
            margin-top: 20px;
            display: none;
        }

        .search-result-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #ff9800;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .result-info h3 {
            color: #e65100;
            margin-bottom: 5px;
        }

        .result-info p {
            color: #666;
            font-size: 0.9em;
        }

        .distance-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            white-space: nowrap;
        }

        .content {
            padding: 30px;
        }

        .day-section {
            margin-bottom: 40px;
            border: 2px solid #fce4ec;
            border-radius: 15px;
            overflow: hidden;
        }

        .day-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .day-header:hover {
            opacity: 0.9;
        }

        .day-title {
            font-size: 1.5em;
            font-weight: bold;
        }

        .day-progress {
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .locations {
            padding: 20px;
            background: #fef5f7;
            min-height: 100px;
        }

        .location-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #f093fb;
            transition: all 0.3s ease;
            cursor: move;
            position: relative;
        }

        .location-item:hover {
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.15);
            transform: translateX(5px);
        }

        .location-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .location-item.completed {
            opacity: 0.6;
            background: #fce4ec;
        }

        .location-item.completed .location-name {
            text-decoration: line-through;
        }

        .location-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .edit-btn, .delete-btn {
            background: #fff;
            border: 1px solid #ddd;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s ease;
        }

        .edit-btn:hover {
            background: #42a5f5;
            color: white;
            border-color: #42a5f5;
        }

        .delete-btn:hover {
            background: #ef5350;
            color: white;
            border-color: #ef5350;
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
            padding-right: 100px;
        }

        .location-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .checkbox-container {
            margin-bottom: 10px;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #f5576c;
            margin-right: 10px;
        }

        .location-time {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            display: inline-block;
            margin-right: 5px;
        }

        .location-cost {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }

        .location-notes {
            color: #4a5568;
            line-height: 1.6;
            margin: 10px 0;
        }

        .location-links {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .map-link, .grab-link, .view-map-btn {
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .map-link {
            background: linear-gradient(135deg, #42a5f5 0%, #1976d2 100%);
            color: white;
        }

        .grab-link {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
        }

        .view-map-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .map-link:hover, .grab-link:hover, .view-map-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .tips-section {
            background: #fff8e1;
            border: 2px solid #ffeb3b;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }

        .tips-section h2 {
            color: #f57f17;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .tips-section ul {
            list-style: none;
            padding-left: 0;
        }

        .tips-section li {
            padding: 10px 0;
            border-bottom: 1px solid #fff9c4;
            color: #f57f17;
        }

        .tips-section li:last-child {
            border-bottom: none;
        }

        .transport-info {
            background: #e3f2fd;
            border: 2px solid #42a5f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .transport-info h2 {
            color: #0d47a1;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .transport-option {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #42a5f5;
        }

        .transport-option h3 {
            color: #1976d2;
            margin-bottom: 5px;
        }

        .reset-btn, .save-btn {
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .reset-btn {
            background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
        }

        .reset-btn:hover, .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .close:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-body input, .modal-body select, .modal-body textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .modal-body input:focus, .modal-body select:focus, .modal-body textarea:focus {
            outline: none;
            border-color: #f5576c;
        }

        .drag-handle {
            cursor: move;
            color: #999;
            font-size: 1.2em;
            margin-right: 10px;
            user-select: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            display: none;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }

            .location-header {
                padding-right: 0;
            }

            .location-controls {
                position: static;
                margin-top: 10px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .search-container {
                flex-direction: column;
            }

            .search-input {
                min-width: 100%;
            }
        }

        .collapse-icon {
            transition: transform 0.3s ease;
        }

        .collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">Saved!</div>

    <div class="container">
        <div class="header">
            <h1>üáÆüá© Jakarta Shopping & Spa Adventure</h1>
            <p>February 15-18, 2026 | Real-Time Collaboration ‚ú®</p>
            <div class="sync-status" id="syncStatus">üîÑ Connecting...</div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3>Total Locations</h3>
                <p id="totalLocations">21</p>
            </div>
            <div class="stat-card">
                <h3>Completed</h3>
                <p id="completedLocations">0</p>
            </div>
            <div class="stat-card">
                <h3>Progress</h3>
                <p id="progressPercent">0%</p>
            </div>
            <div class="stat-card">
                <h3>Est. Transport Cost</h3>
                <p>RM130-180</p>
            </div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <h2>üîç Search & Add New Locations</h2>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search for a place in Jakarta...">
                <button class="search-btn" onclick="searchLocation()">Search & Calculate Distance</button>
                <button class="add-btn" onclick="openAddModal()">‚ûï Add New Location</button>
            </div>
            <div class="current-location" id="currentLocation">
                üìç Current Location: <strong>Swiss-Belinn Wahid Hasyim</strong> (Hotel)
            </div>
            <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="search-btn" onclick="useGPS()" style="font-size: 0.9em; padding: 8px 16px;">üì° Use My GPS Location</button>
                <small style="color: #666; align-self: center;">Or click "Set as Current" on any location below</small>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>

        <div class="content">
            <div class="transport-info">
                <h2>‚úàÔ∏è Airport Transport (Soekarno-Hatta ‚Üí Hotel)</h2>
                <div class="transport-option">
                    <h3>Option 1: Grab/Taxi (Recommended)</h3>
                    <p>üí∞ RM45-55 | ‚è±Ô∏è 20-30 mins | üìç ~25km</p>
                </div>
                <div class="transport-option">
                    <h3>Option 2: Airport Train + Taxi</h3>
                    <p>üí∞ RM21 total | ‚è±Ô∏è ~1 hour</p>
                </div>
                <div class="transport-option">
                    <h3>Option 3: Damri Bus</h3>
                    <p>üí∞ RM10-13 | ‚è±Ô∏è 30-50 mins</p>
                </div>
            </div>

            <div id="daysContainer">
                <!-- Days will be dynamically generated -->
            </div>

            <!-- TIPS SECTION -->
            <div class="tips-section">
                <h2>üî• INSIDER TIPS FROM LOCALS</h2>
                <ul>
                    <li>üíÜ‚Äç‚ôÄÔ∏è <strong>Sendja Spa:</strong> BOOK AHEAD! RM70 for 90min is insanely cheap for this quality</li>
                    <li>üõçÔ∏è <strong>Tanah Abang:</strong> Arrive 8am sharp, walk deeper inside for better prices, BARGAIN HARD, BRING CASH</li>
                    <li>‚òï <strong>Kopi Tuku:</strong> Always crowded but line moves fast - the hype is REAL</li>
                    <li>üå°Ô∏è <strong>PIK by the Sea:</strong> Outdoor area can be HOT - bring a fan or portable AC</li>
                    <li>üè¨ <strong>Thamrin City:</strong> More organized than Tanah Abang, still great for Eid shopping</li>
                    <li>üí≥ <strong>Payment:</strong> Most shops prefer CASH. Some accept QRIS (MAE works for Malaysians!)</li>
                    <li>üì± <strong>Grab:</strong> Download the app before arrival - it's like your Malaysian Grab</li>
                    <li>üè¢ <strong>ASHTA District 8:</strong> Trendy spot in SCBD with modern Indonesian brands</li>
                    <li>üö® <strong>National Museum:</strong> CLOSED on Mondays! Plan accordingly</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <p style="color: #666; margin-bottom: 10px;">üîÑ Changes sync automatically across all devices!</p>
            </div>
        </div>
    </div>

    <!-- Edit Location Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Location</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="editName" placeholder="Location name">
                <input type="text" id="editTime" placeholder="Time (e.g., 2:00 PM)">
                <input type="text" id="editCost" placeholder="Cost (e.g., RM25-32)">
                <textarea id="editNotes" rows="4" placeholder="Notes about this location..."></textarea>
                <button class="save-btn" onclick="saveEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add Location Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Location</h2>
                <span class="close" onclick="closeAddModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="addName" placeholder="Location name *">
                <input type="text" id="addAddress" placeholder="Address *">
                <select id="addDay">
                    <option value="1">Day 1 (Sun, Feb 15)</option>
                    <option value="2">Day 2 (Mon, Feb 16)</option>
                    <option value="3">Day 3 (Tue, Feb 17)</option>
                    <option value="4">Day 4 (Wed, Feb 18)</option>
                </select>
                <input type="text" id="addTime" placeholder="Time (e.g., 2:00 PM)">
                <input type="text" id="addCost" placeholder="Cost (e.g., RM25-32)">
                <textarea id="addNotes" rows="4" placeholder="Notes about this location..."></textarea>
                <button class="add-btn" onclick="addNewLocation()">Add to Itinerary</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, update, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDMCre9Bf8AYpHhiLekeRmlzLnOaJ91VcU",
            authDomain: "riri-jkt26.firebaseapp.com",
            databaseURL: "https://riri-jkt26-default-rtdb.firebaseio.com",
            projectId: "riri-jkt26",
            storageBucket: "riri-jkt26.firebasestorage.app",
            messagingSenderId: "55531621040",
            appId: "1:55531621040:web:1d1b70e81ee728c18f0975",
            measurementId: "G-S0VBJLQXP6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        window.db = database;
        window.dbRef = ref;
        window.dbSet = set;
        window.dbUpdate = update;
        window.dbRemove = remove;
        window.dbOnValue = onValue;

        // Initial itinerary data
        const defaultItinerary = {
            1: [
                { id: 'hotel-checkin', name: 'üè® Swiss-Belinn Wahid Hasyim (Check-in)', time: '10:00 AM', cost: '', lat: -6.192, lng: 106.824, notes: '<strong>From Airport:</strong> RM45-55 (Grab/Taxi) | RM21 (Train+Taxi) | RM10-13 (Bus)<br>üìç Distance: ~25km | ‚è±Ô∏è 20-30 mins by car', address: 'Jl. K.H. Wahid Hasyim No.87, Jakarta Pusat' },
                { id: 'pagi-sore', name: 'üçõ Pagi Sore PIK (Brunch)', time: '11:30 AM', cost: 'RM25-32', lat: -6.0886386, lng: 106.7434524, notes: 'Famous Padang restaurant! Must try: <strong>Ayam Pop, Rendang, Beef Tunjang</strong><br>üí° They store luggage for free! | üìç ~18km from hotel', address: 'Jl. Pantai Indah Kapuk, PIK, Jakarta Utara' },
                { id: 'pik-sea', name: 'üõçÔ∏è PIK by the Sea Shopping District', time: '1:30 PM - 4:00 PM', cost: '', lat: -6.0933144, lng: 106.7505158, notes: '<strong>LOCAL BRANDS HEAVEN!</strong> Paddy Perfume Lab, Bodies, 3Mongkis, √†mavee, MAGA perfume, KAMI, Nubuk, MAIA<br>‚ö†Ô∏è Outdoor area - can be hot! Bring fan if needed | üö∂ 5 min walk from Pagi Sore', address: 'Golf Island, PIK, Jakarta Utara' },
                { id: 'plaza-indo', name: 'üíé Plaza Indonesia (Window Shopping)', time: '5:00 PM', cost: 'RM25-32', lat: -6.1935977, lng: 106.8219468, notes: 'Luxury brands: LV, Dior, Balenciaga, Chanel<br>üìç ~18km from PIK | Connected to Grand Indonesia', address: 'Jl. M.H. Thamrin No.28-30, Jakarta Pusat' },
                { id: 'kopi-tuku', name: '‚òï Kopi Tuku - Blok M (VIRAL!)', time: '7:00 PM', cost: 'RM10-13 transport', lat: -6.2439233, lng: 106.7997294, notes: '<strong>Order: Kopi Tetangga (RM6)</strong> - super viral coffee!<br>üí° Always crowded but line moves fast | üìç ~5km from Plaza Indonesia', address: 'Jl. Sultan Hasanuddin Dalam No.25, Blok M, Jakarta Selatan' },
                { id: 'uma-oma', name: 'üçú Uma Oma Cafe (Dinner)', time: '8:00 PM', cost: '', lat: -6.2438779, lng: 106.8016779, notes: 'Famous for <strong>Nasi Lidah (ox tongue)</strong> & traditional Indonesian dishes<br>üè° Grandma\'s house vibe, cozy lighting | üö∂ 5 min walk from Kopi Tuku', address: 'Jl. Melawai I No.28, Blok M, Jakarta Selatan' }
            ],
            2: [
                { id: 'sendja-spa', name: 'üíÜ‚Äç‚ôÄÔ∏è Sendja Spa Cilandak (MUST DO!)', time: '9:30 AM', cost: 'RM70 spa + RM13-19 transport', lat: -6.2940993, lng: 106.7997288, notes: '<strong>‚≠ê 90min package: RM70 (295k IDR)</strong> - Massage + Body Scrub + Shower<br>üö® <strong>MUST BOOK AHEAD!</strong> Super popular! Zen vibes, complete amenities<br>üìç ~11km from hotel | Rating: 4.8/5 ‚≠ê', address: 'Jl. Intan No.8, Cilandak, Jakarta Selatan' },
                { id: 'seribu-rasa', name: 'üçΩÔ∏è Seribu Rasa Menteng (Lunch)', time: '12:30 PM', cost: 'RM13-19', lat: -6.1954892, lng: 106.8247941, notes: 'Refined Indonesian restaurant - authentic archipelago flavors, elegant setting<br>üìç ~10km from spa', address: 'Jl. H. Agus Salim No.128, Menteng, Jakarta Pusat' },
                { id: 'nat-museum', name: 'üèõÔ∏è National Museum of Indonesia', time: '2:30 PM', cost: 'RM6 entry + RM4-7 transport', lat: -6.1764021, lng: 106.8215901, notes: 'Recently renovated, beautiful exhibits of Indonesian culture<br>‚ö†Ô∏è <strong>CLOSED MONDAYS!</strong> | üìç ~2km | ‚è±Ô∏è 2 hours visit', address: 'Jl. Medan Merdeka Barat No.12, Jakarta Pusat' },
                { id: 'thamrin-city', name: 'üõçÔ∏è Thamrin City (Eid Shopping)', time: '5:00 PM', cost: 'RM4-7', lat: -6.1941659, lng: 106.8160933, notes: 'More organized than Tanah Abang! Batik, Muslim wear, textiles<br>üí° Walk deeper inside for better prices | üí∞ CASH preferred | üìç ~2km', address: 'Jl. H. M. Saleh Ishak, Jakarta Pusat' },
                { id: 'senayan-city', name: 'üè¨ Senayan City Mall', time: '8:00 PM', cost: 'RM10-13', lat: -6.2271953, lng: 106.7970117, notes: 'Upscale mall - 400+ shops! Harlan + Holden Coffee, Alchemist Perfume<br>üìç ~5km from Thamrin City', address: 'Jl. Asia Afrika No.19, Jakarta Pusat' }
            ],
            3: [
                { id: 'tanah-abang', name: 'üè™ Pasar Tanah Abang Blok C (MAIN EVENT!)', time: '8:00 AM - 11:00 AM', cost: 'RM4-7', lat: -6.188576, lng: 106.8146008, notes: '<strong>üî• ASIA\'S LARGEST TEXTILE MARKET!</strong><br>8 floors: Muslim clothing, batik, fabrics - wholesale prices<br>üí° Arrive 8am SHARP for best selection! BARGAIN HARD! BRING CASH!<br>üìç ~2km from hotel', address: 'Jl. Kebon Kacang, Tanah Abang, Jakarta Pusat' },
                { id: 'sarinah', name: 'üéÅ Sarinah (Indonesian Brands)', time: '12:00 PM', cost: 'RM4-7', lat: -6.1877521, lng: 106.8235864, notes: 'Local crafts, textiles, Filosofi Kopi cafe<br>üî• <strong>70% discount on many items!</strong> | üìç ~2km', address: 'Jl. M.H. Thamrin No.11, Jakarta Pusat' },
                { id: 'ashta', name: 'üè¢ ASHTA District 8 (1st Floor/Marketplace)', time: '1:30 PM', cost: 'RM4-7', lat: -6.2264, lng: 106.8087, notes: 'Modern shopping complex in SCBD (South Jakarta)<br>üìç Jl. Jend. Sudirman Kav. 52-53 | Trendy local brands & cafes', address: 'Jl. Jend. Sudirman Kav. 52-53, SCBD, Jakarta Selatan' },
                { id: 'gandaria', name: 'üè¨ Gandaria City', time: '3:30 PM', cost: 'RM10-13', lat: -6.2439854, lng: 106.7836671, notes: 'Modern mall with unique skylights! Chikuro brand, great food court<br>üìç ~6km from ASHTA', address: 'Jl. Sultan Iskandar Muda, Jakarta Selatan' },
                { id: 'grand-indo', name: 'üõçÔ∏è Grand Indonesia (Final Shopping)', time: '6:00 PM', cost: 'RM10-13', lat: -6.1953681, lng: 106.8204181, notes: 'Massive mall - luxury to affordable brands<br>Perfect for last-minute gifts & purchases | üìç ~7km', address: 'Jl. MH Thamrin No.1, Jakarta Pusat' },
                { id: 'semaja', name: 'üçΩÔ∏è SEMAJA Menteng (Dinner)', time: '8:30 PM', cost: '', lat: -6.1908813, lng: 106.8281019, notes: 'Modern Indonesian cuisine in resort-style setting<br>üö∂ ~1km, can walk from Grand Indonesia', address: 'Jl. Gereja Theresia No.41, Menteng, Jakarta Pusat' }
            ],
            4: [
                { id: 'checkout', name: 'üè® Hotel Checkout', time: '10:00 AM', cost: '', lat: -6.192, lng: 106.824, notes: 'Check out from Swiss-Belinn Wahid Hasyim<br>Store luggage if available for last-minute activities', address: 'Jl. K.H. Wahid Hasyim No.87, Jakarta Pusat' },
                { id: 'brunch-gi', name: '‚òï Brunch at Grand Indonesia', time: '11:00 AM', cost: 'RM4-7', lat: -6.1953681, lng: 106.8204181, notes: 'Last meal & final shopping at Grand Indonesia food court<br>üìç ~2km from hotel', address: 'Jl. MH Thamrin No.1, Jakarta Pusat' },
                { id: 'last-shop', name: 'üõçÔ∏è Last-minute Shopping (Plaza Indonesia)', time: '1:00 PM - 3:00 PM', cost: '', lat: -6.1935977, lng: 106.8219468, notes: 'Final gift shopping or souvenirs<br>üö∂ Connected to Grand Indonesia', address: 'Jl. M.H. Thamrin No.28-30, Jakarta Pusat' },
                { id: 'airport', name: '‚úàÔ∏è Soekarno-Hatta Airport', time: '4:00 PM', cost: 'RM45-55', lat: -6.1256, lng: 106.6559, notes: '<strong>Departure at 7:00 PM - Arrive by 4:00 PM!</strong><br>üìç ~25km from Plaza Indonesia | ‚è±Ô∏è Allow 2-3 hours before flight<br>Grab/Taxi recommended: RM45-55 (20-30 mins without traffic)', address: 'Soekarno-Hatta International Airport' }
            ]
        };

        // Initialize database with default data if empty
        const itineraryRef = window.dbRef(window.db, 'itinerary');
        window.dbOnValue(itineraryRef, (snapshot) => {
            if (!snapshot.exists()) {
                window.dbSet(itineraryRef, defaultItinerary);
                console.log('Initialized database with default itinerary');
            }
        }, { onlyOnce: true });

        // Listen for connection status
        const connectedRef = window.dbRef(window.db, '.info/connected');
        window.dbOnValue(connectedRef, (snap) => {
            const status = document.getElementById('syncStatus');
            if (snap.val() === true) {
                status.textContent = '‚úÖ Connected';
                status.className = 'sync-status connected';
            } else {
                status.textContent = '‚ö†Ô∏è Offline';
                status.className = 'sync-status disconnected';
            }
        });

        console.log('Firebase initialized successfully!');
        window.firebaseReady = true;
    </script>

    <script>
        let currentLat = -6.192;
        let currentLng = 106.824;
        let currentEditingId = null;
        let currentEditingDay = null;
        let draggedElement = null;
        let itinerary = {};

        // Wait for Firebase to be ready
        function waitForFirebase(callback) {
            if (window.firebaseReady) {
                callback();
            } else {
                setTimeout(() => waitForFirebase(callback), 100);
            }
        }

        // Listen to Firebase for real-time updates
        waitForFirebase(() => {
            const itineraryRef = window.dbRef(window.db, 'itinerary');
            window.dbOnValue(itineraryRef, (snapshot) => {
                if (snapshot.exists()) {
                    itinerary = snapshot.val();
                    renderDays();
                    loadProgress();
                }
            });

            // Listen to checkboxes
            const checkboxesRef = window.dbRef(window.db, 'checkboxes');
            window.dbOnValue(checkboxesRef, (snapshot) => {
                if (snapshot.exists()) {
                    const checkboxes = snapshot.val();
                    for (let id in checkboxes) {
                        const checkbox = document.getElementById('check-' + id);
                        if (checkbox) {
                            checkbox.checked = checkboxes[id];
                        }
                    }
                    updateProgress();
                }
            });
        });

        // Render all days
        function renderDays() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = '';

            const dayTitles = {
                1: 'Day 1 (Sun, Feb 15): PIK by the Sea & Cafe Hopping',
                2: 'Day 2 (Mon, Feb 16): Spa Day, Museum & Shopping',
                3: 'Day 3 (Tue, Feb 17): All-Out Eid Shopping Day!',
                4: 'Day 4 (Wed, Feb 18): Departure Day'
            };

            const daySubtitles = {
                1: 'Arrival, local brands, luxury shopping & viral coffee',
                2: 'Pamper yourself + cultural exploration + mall hopping',
                3: 'Tanah Abang textile market + modern malls + ASHTA District 8',
                4: 'Last-minute shopping & airport departure (7pm flight)'
            };

            for (let day = 1; day <= 4; day++) {
                const locations = itinerary[day] || [];
                
                const daySection = document.createElement('div');
                daySection.className = 'day-section';
                daySection.innerHTML = `
                    <div class="day-header" onclick="toggleDay(${day})">
                        <div>
                            <div class="day-title">${dayTitles[day]}</div>
                            <small>${daySubtitles[day]}</small>
                        </div>
                        <div class="day-progress" id="day${day}Progress">0/${locations.length}</div>
                        <span class="collapse-icon">‚ñº</span>
                    </div>
                    <div class="locations" id="day${day}" ondrop="drop(event, ${day})" ondragover="allowDrop(event)" style="display: block;">
                        ${renderLocations(day)}
                    </div>
                `;
                container.appendChild(daySection);
            }

            updateProgress();
        }

        // Render locations for a specific day
        function renderLocations(day) {
            if (!itinerary[day] || itinerary[day].length === 0) {
                return '<div style="text-align: center; padding: 20px; color: #999;">No locations for this day yet. Drag locations here or add new ones!</div>';
            }

            return itinerary[day].map(loc => `
                <div class="location-item" 
                     data-id="${loc.id}" 
                     data-day="${day}"
                     data-lat="${loc.lat}" 
                     data-lng="${loc.lng}"
                     draggable="true"
                     ondragstart="drag(event)">
                    <div class="location-controls">
                        <button class="edit-btn" onclick="editLocation('${loc.id}', ${day})">‚úèÔ∏è Edit</button>
                        <button class="delete-btn" onclick="deleteLocation('${loc.id}', ${day})">üóëÔ∏è Delete</button>
                    </div>
                    <div>
                        <div class="checkbox-container">
                            <span class="drag-handle">‚ò∞</span>
                            <input type="checkbox" onchange="saveCheckbox('${loc.id}')" id="check-${loc.id}">
                            <label for="check-${loc.id}" style="cursor: pointer;">Check when done</label>
                        </div>
                        <div class="location-header">
                            <div>
                                <div class="location-name">${loc.name}</div>
                                ${loc.time ? `<span class="location-time">${loc.time}</span>` : ''}
                                ${loc.cost ? `<span class="location-cost">${loc.cost}</span>` : ''}
                            </div>
                        </div>
                        <div class="location-notes">${loc.notes}</div>
                        <div class="location-links">
                            <a href="https://www.google.com/maps/search/?api=1&query=${loc.lat},${loc.lng}" 
                               target="_blank" 
                               class="map-link">
                                üó∫Ô∏è Google Maps
                            </a>
                            <a href="https://www.google.com/maps/dir/?api=1&origin=${currentLat},${currentLng}&destination=${loc.lat},${loc.lng}&travelmode=driving" 
                               target="_blank" 
                               class="grab-link">
                                üöó Get Directions
                            </a>
                            <button class="view-map-btn" onclick="updateCurrentLocation(${loc.lat}, ${loc.lng}, '${loc.name.replace(/'/g, "\\'")}')">
                                üìç Set as Current
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Save checkbox state to Firebase
        function saveCheckbox(id) {
            const checkbox = document.getElementById('check-' + id);
            if (checkbox) {
                const checkboxRef = window.dbRef(window.db, `checkboxes/${id}`);
                window.dbSet(checkboxRef, checkbox.checked);
            }
        }

        // Drag and drop functions
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            draggedElement = ev.target.closest('.location-item');
            ev.dataTransfer.effectAllowed = 'move';
            draggedElement.classList.add('dragging');
        }

        function drop(ev, targetDay) {
            ev.preventDefault();
            if (!draggedElement) return;

            draggedElement.classList.remove('dragging');
            
            const sourceDay = parseInt(draggedElement.dataset.day);
            const locationId = draggedElement.dataset.id;

            if (sourceDay === targetDay) return;

            // Find and remove location from source day
            const locationIndex = itinerary[sourceDay].findIndex(loc => loc.id === locationId);
            if (locationIndex === -1) return;

            const location = itinerary[sourceDay][locationIndex];
            itinerary[sourceDay].splice(locationIndex, 1);

            // Add to target day
            itinerary[targetDay].push(location);

            // Save to Firebase
            const itineraryRef = window.dbRef(window.db, 'itinerary');
            window.dbSet(itineraryRef, itinerary);

            showNotification('Location moved to Day ' + targetDay);
        }

        // Edit location
        function editLocation(id, day) {
            const location = itinerary[day].find(loc => loc.id === id);
            if (!location) return;

            currentEditingId = id;
            currentEditingDay = day;

            document.getElementById('editName').value = location.name.replace(/üè®|üçõ|üõçÔ∏è|üíé|‚òï|üçú|üíÜ‚Äç‚ôÄÔ∏è|üçΩÔ∏è|üèõÔ∏è|üè¨|üè™|üéÅ|üè¢|‚úàÔ∏è/g, '').trim();
            document.getElementById('editTime').value = location.time || '';
            document.getElementById('editCost').value = location.cost || '';
            document.getElementById('editNotes').value = location.notes.replace(/<br>/g, '\n').replace(/<\/?strong>/g, '');

            document.getElementById('editModal').style.display = 'block';
        }

        function saveEdit() {
            const location = itinerary[currentEditingDay].find(loc => loc.id === currentEditingId);
            if (!location) return;

            const emoji = location.name.match(/^[üè®üçõüõçÔ∏èüíé‚òïüçúüíÜ‚Äç‚ôÄÔ∏èüçΩÔ∏èüèõÔ∏èüè¨üè™üéÅüè¢‚úàÔ∏è]/)?.[0] || '';
            location.name = emoji + ' ' + document.getElementById('editName').value;
            location.time = document.getElementById('editTime').value;
            location.cost = document.getElementById('editCost').value;
            location.notes = document.getElementById('editNotes').value.replace(/\n/g, '<br>');

            // Save to Firebase
            const itineraryRef = window.dbRef(window.db, 'itinerary');
            window.dbSet(itineraryRef, itinerary);

            closeEditModal();
            showNotification('Location updated!');
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Delete location
        function deleteLocation(id, day) {
            if (!confirm('Are you sure you want to delete this location? This will affect everyone!')) return;

            const index = itinerary[day].findIndex(loc => loc.id === id);
            if (index === -1) return;

            itinerary[day].splice(index, 1);

            // Save to Firebase
            const itineraryRef = window.dbRef(window.db, 'itinerary');
            window.dbSet(itineraryRef, itinerary);

            showNotification('Location deleted');
        }

        // Add new location
        function openAddModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        function closeAddModal() {
            document.getElementById('addModal').style.display = 'none';
        }

        function addNewLocation() {
            const name = document.getElementById('addName').value;
            const address = document.getElementById('addAddress').value;
            const day = parseInt(document.getElementById('addDay').value);
            const time = document.getElementById('addTime').value;
            const cost = document.getElementById('addCost').value;
            const notes = document.getElementById('addNotes').value;

            if (!name || !address) {
                alert('Please fill in at least the location name and address');
                return;
            }

            const newLocation = {
                id: 'custom-' + Date.now(),
                name: 'üìç ' + name,
                time: time,
                cost: cost,
                lat: -6.2 + Math.random() * 0.1,
                lng: 106.8 + Math.random() * 0.1,
                notes: notes,
                address: address
            };

            itinerary[day].push(newLocation);

            // Save to Firebase
            const itineraryRef = window.dbRef(window.db, 'itinerary');
            window.dbSet(itineraryRef, itinerary);
            
            // Clear form
            document.getElementById('addName').value = '';
            document.getElementById('addAddress').value = '';
            document.getElementById('addTime').value = '';
            document.getElementById('addCost').value = '';
            document.getElementById('addNotes').value = '';
            
            closeAddModal();
            showNotification('Location added to Day ' + day);
        }

        // Update current location
        function updateCurrentLocation(lat, lng, name) {
            currentLat = lat;
            currentLng = lng;
            document.getElementById('currentLocation').innerHTML = `üìç Current Location: <strong>${name}</strong>`;
            showNotification('Current location updated');
        }

        // Use GPS
        function useGPS() {
            if (!navigator.geolocation) {
                alert('GPS not supported by your browser');
                return;
            }

            showNotification('Getting your location...');
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    currentLat = position.coords.latitude;
                    currentLng = position.coords.longitude;
                    document.getElementById('currentLocation').innerHTML = 
                        `üìç Current Location: <strong>GPS Location (${currentLat.toFixed(4)}, ${currentLng.toFixed(4)})</strong>`;
                    showNotification('GPS location updated! ‚úÖ');
                },
                function(error) {
                    alert('Could not get GPS location. Please enable location services or click "Set as Current" on any location.');
                }
            );
        }

        // Calculate distance
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Search location
        function searchLocation() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query) {
                alert('Please enter a location name');
                return;
            }

            resultsDiv.innerHTML = '';
            let found = false;

            // Search in itinerary
            for (let day in itinerary) {
                itinerary[day].forEach(loc => {
                    if (loc.name.toLowerCase().includes(query) || loc.address.toLowerCase().includes(query)) {
                        const distance = calculateDistance(currentLat, currentLng, loc.lat, loc.lng);
                        const grabCost = Math.round(distance * 2.5);
                        
                        resultsDiv.innerHTML += `
                            <div class="search-result-item">
                                <div class="result-info">
                                    <h3>${loc.name}</h3>
                                    <p>üìç ${distance.toFixed(1)} km from current location</p>
                                    <p>üí∞ Estimated Grab cost: RM${grabCost}-${grabCost + 10}</p>
                                    <p>üìÖ Currently in Day ${day}</p>
                                </div>
                                <div>
                                    <span class="distance-badge">${distance.toFixed(1)} km</span>
                                    <a href="https://www.google.com/maps/dir/?api=1&origin=${currentLat},${currentLng}&destination=${loc.lat},${loc.lng}" 
                                       target="_blank" 
                                       class="view-map-btn">
                                        Get Directions
                                    </a>
                                </div>
                            </div>
                        `;
                        found = true;
                    }
                });
            }

            if (found) {
                resultsDiv.style.display = 'block';
            } else {
                resultsDiv.innerHTML = '<div class="search-result-item"><p>No results found. Try: Plaza Indonesia, Tanah Abang, ASHTA, etc.</p></div>';
                resultsDiv.style.display = 'block';
            }
        }

        // Update progress
        function updateProgress() {
            let total = 0;
            let completed = 0;

            for (let day = 1; day <= 4; day++) {
                const dayLocations = itinerary[day] ? itinerary[day].length : 0;
                total += dayLocations;

                const checkboxes = document.querySelectorAll(`[data-day="${day}"] input[type="checkbox"]`);
                const dayCompleted = Array.from(checkboxes).filter(cb => cb.checked).length;
                completed += dayCompleted;

                const progressEl = document.getElementById(`day${day}Progress`);
                if (progressEl) {
                    progressEl.textContent = `${dayCompleted}/${dayLocations}`;
                }

                // Toggle completed class
                checkboxes.forEach(checkbox => {
                    const item = checkbox.closest('.location-item');
                    if (item) {
                        if (checkbox.checked) {
                            item.classList.add('completed');
                        } else {
                            item.classList.remove('completed');
                        }
                    }
                });
            }

            const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('totalLocations').textContent = total;
            document.getElementById('completedLocations').textContent = completed;
            document.getElementById('progressPercent').textContent = percent + '%';
        }

        // Load progress
        function loadProgress() {
            // Progress is loaded from Firebase automatically
            updateProgress();
        }

        // Toggle day
        function toggleDay(dayNum) {
            const daySection = document.getElementById(`day${dayNum}`);
            const header = daySection.previousElementSibling;
            
            if (daySection.style.display === 'none') {
                daySection.style.display = 'block';
                header.classList.remove('collapsed');
            } else {
                daySection.style.display = 'none';
                header.classList.add('collapsed');
            }
        }

        // Show notification
        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 2000);
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Search on Enter
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchLocation();
                    }
                });
            }
        });
    </script>
</body>
</html>
